#include "stm32f10x.h"
#include "delay.h"
#include "spi.h"
#include "ec11.h"
#include "oled.h"

//图标 垂直扫描，从左到右，从上到下，高位在前
//48x48
const unsigned char ICON_48X48[][288] = 
{
    {   //setting
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x80,0xF0,0xF8,0xF8,0xFC,0x7C,0x7C,0x7C,0x7C,0x7C,0x7C,0xFC,0xF8,0xF8,0xF0,0x80,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x80,0xE0,0xF8,0xFC,0xFE,0x3F,0x1F,0x1E,0x1E,0x3E,0x3C,0x3E,
    0x3F,0x1F,0x0F,0x0F,0x81,0x80,0x80,0xC0,0xC0,0x80,0x80,0x81,0x0F,0x0F,0x1F,0x3F,
    0x3E,0x3C,0x3E,0x1E,0x1E,0x1F,0x3F,0xFE,0xFC,0xF8,0xE0,0x80,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x0F,0x1F,0x3F,0x7F,0xFD,0xF8,0xF0,0xE0,0x00,0x00,0x00,0xC0,0xF0,
    0xFC,0xFE,0xFF,0x1F,0x0F,0x07,0x07,0x07,0x07,0x07,0x07,0x0F,0x1F,0xFF,0xFE,0xFC,
    0xF0,0xC0,0x00,0x00,0x00,0xE0,0xF0,0xF8,0xFD,0x7F,0x3F,0x1F,0x0F,0x00,0x00,0x00,
    0x00,0x00,0x00,0xF0,0xF8,0xFC,0xFE,0xBF,0x1F,0x0F,0x07,0x00,0x00,0x00,0x03,0x0F,
    0x3F,0x7F,0xFF,0xF8,0xF0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xF0,0xF8,0xFF,0x7F,0x3F,
    0x1F,0x03,0x00,0x00,0x00,0x07,0x0F,0x1F,0xBF,0xFE,0xFC,0xF8,0xF0,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x01,0x07,0x1F,0x3F,0x7F,0xFC,0xF8,0x78,0x78,0x7C,0x3C,0x7C,
    0xFC,0xF8,0xF0,0xF0,0x81,0x01,0x01,0x03,0x03,0x01,0x01,0x81,0xF0,0xF0,0xF8,0xFC,
    0x7C,0x3C,0x7C,0x78,0x78,0xF8,0xFC,0x7F,0x3F,0x1F,0x07,0x01,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x0F,0x1F,0x1F,0x3F,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3F,0x1F,0x1F,0x0F,0x01,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    },
    {   //port
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xC0,0xC0,0x80,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0xE0,0xE0,0xE0,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0xC0,0xE0,0xF0,0xF8,0xFC,0x7E,0x3F,0xDF,0xFF,0xFF,0xFF,0xDF,
    0x3F,0x7E,0xFC,0xF8,0xF0,0xE0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,
    0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x80,0xC0,0xE0,0xC0,0x80,0x00,0x00,
    0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x80,0xC0,0xE0,0xC0,0x80,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x0F,0x1F,0x3F,0x7E,
    0xFD,0xFF,0xFF,0xFF,0xFD,0x7E,0x3F,0x1F,0x0F,0x07,0x03,0x01,0x00,0x00,0x00,0x00,
    0x00,0x00,0xF8,0xF8,0xF8,0xF8,0xF8,0x00,0x00,0x00,0x00,0x03,0x03,0x03,0x03,0x03,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0xF8,0xF8,0xF8,0xF8,0xF8,0x00,0x00,
    0x00,0x00,0x07,0x1F,0x1F,0x3F,0x3F,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,
    0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,
    0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3F,0x3F,0x1F,0x1F,0x07,0x00,0x00,
    }
};

#define LED_OFF (GPIOC->BSRR = GPIO_Pin_13) //H
#define LED_ON (GPIOC->BRR = GPIO_Pin_13)	//L

u8 OLEDRAM[OLED_SIZE];
extern u8 framebuffer[1024];
u8 ec11 = 0x00;
extern u8 OLEDSHOW;
int16_t x = 100, y = 0;

int main(void)
{
	GPIO_InitTypeDef GPIO_InitStruct;
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC, ENABLE);
	GPIO_InitStruct.GPIO_Pin = GPIO_Pin_13;
	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_Out_PP;
	GPIO_InitStruct.GPIO_Speed=GPIO_Speed_50MHz;
	GPIO_Init(GPIOC, &GPIO_InitStruct);
	LED_OFF;
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);
	OLED_SPI_GPIO_Init();
	OLED_Init();
	EC11_Init();

    u8 ic[] = {
		0xff,0x81,0x81,0x81,0x81,0x81,0x81,0xff
	};
	//ELEMENT *icon1 = OLED_Create_Element(80, 5, 48, 48, 0x00,(u8 *)ICON_48X48[0]);
	ELEMENT *icon1 = OLED_Create_Element(110, 5, 8, 8, 0x00,ic);
	while (1)
	{
        if (OLEDSHOW)OLED_Display_On();
        else OLED_Display_Off();

        modifyElement(icon1, x, y, 0, 0, (void*)0, 0);
        OLED_Mix_Print();
        delay_ms(10);
    }
	

	/*
	while (1)
	{
		//OLED_GShowString(0, 2, "00000000", OLEDRAM, 1);
		//flushing = 1;
		//OLED_GShowNum(0, 1, lastf, 5, OLEDRAM, 1);
		OLED_GShowNum(0, 4, x, 3, OLEDRAM, 1);
		OLED_GShowNum(0, 6, y, 3, OLEDRAM, 1);
		OLED_RAM_Refresh(OLEDRAM);
		//flushing = 0;
		delay_ms(1);
		OLED_RAM_Clear(OLEDRAM);
	}
	*/
}
